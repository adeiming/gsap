<template>
  <div class="min-h-screen bg-sky-50 text-black" id="wrapper">
    <div id="content">
        <UContainer class="space-y-5 py-10">
            <section class="min-h-screen bg-sky-100 p-10 rounded-xl flex flex-col justify-between relative">
                <h1 class="font-semibold text-xl">Normal</h1>
                <div ref="normal">
                    <div class="bg-sky-600 size-20 _normal"></div>
                </div>
            </section>
            <section class="min-h-screen bg-sky-200 p-10 rounded-xl flex flex-col justify-between relative">
                <h1 class="font-semibold text-xl">Pin</h1>
                <div class="space-y-50">
                    <div class="bg-sky-600 mx-auto size-20 _pin"></div>
                    <div class="bg-sky-900 mx-auto size-20"></div>
                </div>
            </section>
            <section class="min-h-screen bg-sky-100 p-10 rounded-xl relative _timeline-base" ref="timeline-base">
                <h1 class="font-semibold text-xl">Timeline</h1>
                <div class="mt-10">
                    <div class="bg-sky-600 size-20 _timeline"></div>
                </div>
            </section>
            <section class="min-h-screen bg-sky-200 p-10 rounded-xl flex flex-col justify-between relative _self-create-base">
                <h1 class="font-semibold text-xl">Self Create Toggle Class</h1>
                <div class="flex-1 flex justify-center items-center">
                    <div class="bg-sky-600 size-20 _self-create transition-all duration-1000"></div>
                </div>
            </section>
            <section class="min-h-screen bg-sky-100 p-10 rounded-xl relative">
                <h1 class="font-semibold text-xl">Marker</h1>
                <div class="mt-10 space-y-4">
                    <p>
                        Lorem ipsum dolor sit amet <span>consectetur adipisicing elit.</span>  Saepe qui velit eveniet assumenda
                        atque labore maiores, excepturi, dolore, laboriosam praesentium corrupti eos. Voluptatibus vel fugit,
                        quam unde quisquam doloribus voluptatum quod nostrum corrupti aliquam, deleniti, ea corporis numquam maxime
                    </p>
                    <p>
                        nemo necessitatibus delectus repellat beatae culpa. Suscipit quasi a qui aliquid similique quam veniam voluptas
                        enim placeat tempore porro doloribus  <span>hic cupiditate sed dignissimos perferendis</span> nemo consequuntur,
                        commodi accusantium aspernatur rerum aperiam incidunt aut? Quo tempora veniam explicabo error, magnam ullam,
                    </p>
                    <p>
                        ex impedit nemo temporibus aliquam rerum tempore fuga quis, labore nihil natus architecto aperiam! Molestias sunt
                        cupiditate dolore voluptatem quos nulla optio eligendi aspernatur soluta maiores officia enim cum iusto, ullam
                        iure obcaecati voluptatum nobis. <span>Porro odit, saepe tempora debitis illum sit quidem,</span>  temporibus animi beatae
                    </p>
                    <p>
                        sequi ullam quos qui. Molestiae odit  <span>illo sunt, odio quod alias. Commodi id totam esse soluta
                        possimus ex eius cumque, et ea labore sapiente sequi est rem suscipit</span> omnis modi! Nulla magnam voluptates ab
                        voluptas fugiat doloremque unde, velit perspiciatis obcaecati veniam impedit nihil in eaque exercitationem numquam sed,
                    </p>
                    <p>
                        deleniti excepturi deserunt. Cupiditate asperiores magnam non iste voluptatem, voluptates est vitae soluta assumenda
                        inventore, deserunt molestias totam quaerat  <span>doloribus cumque recusandae omnis nostrum. Fuga minima iusto debitis expedita,
                        explicabo, tempora mollitia aliquam veniam voluptatum</span> veritatis eveniet recusandae reprehenderit corrupti nesciunt nam animi eum?
                    </p>
                    <p>
                        Repellat architecto repudiandae id quaerat ad optio eveniet. Eum nostrum corrupti reiciendis saepe quam vitae eligendi molestias.
                        Neque, fugiat officia  <span>atque unde laboriosam harum corrupti minima sapiente vero alias sunt nulla adipisci amet ea magnam </span>nesciunt,
                        vel possimus impedit ratione doloribus et. Cumque fugit numquam et illo? Error, voluptate asperiores similique, officiis laudantium
                    </p>
                    <p>
                        iusto id fuga suscipit qui harum pariatur incidunt labore? Distinctio, ad eum nesciunt inventore corrupti quaerat velit pariatur iure facere
                        quo eligendi optio deserunt necessitatibus enim expedita, fugiat nam voluptatibus alias nihil! Alias, numquam eaque itaque sed aliquam inventore
                        distinctio quibusdam ducimus. <span>Fuga, illo natus illum delectus ad voluptas magnam? Nesciunt, adipisci.</span>  Eveniet hic nobis tempore adipisci fugiat
                    </p>

                    <p>
                        facilis et vel iste nisi veniam aspernatur <span>laborum aut incidunt maiores, nam mollitia pariatur voluptas ad eligendi temporibus quam natus id deserunt.
                        Sit debitis soluta nulla dicta et? Minima rem odio repellat nobis illum id quas, debitis voluptatum accusantium unde placeat, delectus porro
                        quibusdam eveniet, molestiae optio. Culpa, accusantium. Architecto aliquam inventore</span> possimus! Sapiente reprehenderit tempora labore iure,
                    </p>

                    <p>
                        provident repudiandae. Temporibus cum ad ex nostrum, expedita in est dolore accusantium earum repellendus pariatur corporis nesciunt quam illum placeat,
                        quae, enim iure veritatis <span>animi perspiciatis. Delectus quos assumenda ut hic tempore odio impedit neque, deserunt maxime. Voluptatum repellendus
                        a quam iure odio, voluptas eligendi nihil</span> inventore cupiditate saepe doloremque, exercitationem, ipsa temporibus quidem. Assumenda delectus cumque
                    </p>
                    <p>
                        ipsam numquam laborum, <span>fugit officia enim dicta iusto illo alias eius ab veritatis est. Voluptatum, illo voluptatem asperiores assumenda,
                        necessitatibus repellat soluta ab, </span>aperiam numquam quam iste. Porro rerum fugiat sit. Natus magnam, autem aut dolores corrupti
                        odio aperiam, voluptas ab id quo reprehenderit consequatur consequuntur nam! Hic eius expedita autem alias dolor distinctio minus.
                    </p>
                </div>
            </section>
            <section class="min-h-[50vh] font-semibold text-xl bg-sky-200 p-10 rounded-xl flex justify-center items-center relative">
                &copy; AZIMA CORP
            </section>
        </UContainer>
    </div>
  </div>
</template>

<script lang="ts" setup>
    import { gsap } from 'gsap'
    import { ScrollTrigger } from 'gsap/ScrollTrigger'
    import { ScrollSmoother } from 'gsap/ScrollSmoother'

    useHead({
        title: 'Scroll Trigger',
    })

    const normal = useTemplateRef('normal')
    const timelineBase = useTemplateRef('timeline-base')

    onMounted(async () => {
        gsap.registerPlugin(ScrollTrigger, ScrollSmoother);

        await nextTick()

        ScrollSmoother.create({
            wrapper: "#wrapper",
            content: "#content",
            smooth: 2,
            smoothTouch: 0.1
        })

        gsap.fromTo('._normal', {
            x: 0,
            borderRadius: 0
        }, {
            x: () => `+=${Number(normal.value?.offsetWidth) - 80}`,
            borderRadius: '20%',
            rotate: 90,
            scrollTrigger: {
                trigger: '._normal',
                start: 'top center',
                end: 'bottom center',
                scrub: 1,
                // markers: true
            }
        })

        gsap.fromTo('._pin', {
            scale: 1.5,
            borderRadius: '20%',
        }, {
            scale: 1,
            borderRadius: 0,
            scrollTrigger: {
                trigger: '._pin',
                start: 'top center',
                end: '+=200 center',
                pin: true,
                pinSpacing: false,
                scrub: 1,
                // markers: true
            }
        })

        gsap.timeline({
            scrollTrigger: {
                trigger: '._timeline-base',
                start: '20% center',
                end: '80% center',
                scrub: 1,
                // markers: true
            }
        })
        .fromTo('._timeline', {
            x: 0,
        }, {
            x: () => `+=${Number(normal.value?.offsetWidth) - 80}`,
            borderRadius: '20%',
            rotate: 90,
        })
        .to('._timeline', {
            y: () => `+=${Number(timelineBase.value?.offsetHeight) - 250}`,
            rotate: 180,
        })
        .to('._timeline', {
            x: 0,
            borderRadius: 0,
            rotate: 360,
        })

        ScrollTrigger.create({
            trigger: '._self-create-base',
            start: '20% center',
            end: '80% center',
            toggleClass: {
                targets: '._self-create',
                className: 'active'
            },
            // markers: true
        })

        gsap.utils.toArray('span').forEach((el: any) => {
            ScrollTrigger.create({
                trigger: el,
                start: 'top center',
                toggleClass: 'marked',
                // markers: true
            })
        })
    })
</script>

<style scoped>
    span {
        background-image: linear-gradient(yellow, yellow);
        background-size: 0% 100%;
        background-repeat: no-repeat;
        transition: background-size 1s ease-in-out;
    }

    span.marked {
        background-size: 100% 100%;
    }
</style>
